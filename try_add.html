<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>try json</title>
    <style type="text/css">
        #hostlist {
            display: inline-block;
            float: left;
            width: 300px;
            height: 900px;
            border: 1px solid red;
            margin-left: 10px;
            padding: 10px;
        }
    </style>
    <script src="http://apps.bdimg.com/libs/jquery/2.1.1/jquery.min.js"></script>
    <script type="application/javascript">
        var ipdata = {
            "name": "foo_name",
            "createTime": '',
            "Rank": {
                "A192.168.1.1": 12,
                "B172.15.1.125": 56,
                'C172.16.123.18': 10000,
                'D114.114.114.114': 4
            }
        };
        function addip() {
            ipdata['createTime'] = Date.now() / 1000;
            ipdata['name'] = $('#name').val();
//            ipdata.range.start = $('start').val();
//            ipdata.range.stop = $('stop').val();
            $.ajax({
                url: "add.php",
                type: "post",
                dataType: "json",
                data: {data: JSON.stringify(ipdata)},
                success: function (data) {
                    $('#result').append('<br>status:' + data['status'] + '</<br>');
                },
                error: function (data) {
                    $('#result').append('<br>status:' + data['status'] + '</<br>');
                }
            })
        }

        var query_param = {
            'name': 'foo_name',
            //指定范围,这里查询全部范围
            'range': {
                'start': 0,
                'stop': -1
            },
            //带不带分数的查询
            withScores: true
        };

        function querybyname() {
            query_param['name'] = $('#name').val();
            query_param.range.start = $('#start').val();
            query_param.range.stop = $('#stop').val();
            $.ajax({
                url: 'methodSwitch.php?method=queryIPRankByName',
                type: 'post',
                dataType: 'json',
                data: {data: JSON.stringify(query_param)},
                success: function (data) {
                    var html = 'name:' + data['name'] +
                            '<br>create time:' + data['createTime'];
//                    document.write(html);
                    $('#result').find('ol').append('<li>' + html + '</li>');
                    var ipCount = data['Rank'];
                    for (var ip in ipCount) {
                        $('ol').append('<li>ip:' + ip + ' rank:' + ipCount[ip] + '</li>');
                    }
                },
                error: function (data) {
                    document.write('query failed!');
                }
            })
        }

        var query_param_by_timeinterval = {
            'name': 'foo_name',
            'range': {
                start: 12312,
                stop: 1232333
            },
            withScores: true
        };

        function querybytimeinterval() {
//            query_param_by_timeinterval['range']['stop'] = Date.now();
//            query_param_by_timeinterval['range']['start'] = Date.now() - 10 * 1000;//查询最近10s添加的数据
            query_param_by_timeinterval['name'] = $('#name').val();
            query_param_by_timeinterval['range'].start = $('#start').val();
            query_param_by_timeinterval['range'].stop = $('#stop').val();
            $.ajax({
                url: 'methodSwitch.php?method=queryIPRankByTimeInterval',
                type: 'post',
                dataType: 'json',
                data: {data: JSON.stringify(query_param_by_timeinterval)},
                success: function (data) {
                    var html = 'name: ' + data['name'] + '<br>create time: ' + data['createTime'];
                    $('#result').find('ol').append('<li>' + html + '</li>');
                    var ipRank = data['Rank'];
                    for (var ip in ipRank) {
                        $('#result').find('ol').append('<li>ip: ' + ip + ' rank: ' + ipRank[ip] + '</li>');
                    }
                },
                error: function (data) {
                    document.write('query failed!');
                }
            })
        }
        var del_param = {
            name: 'foo_name'
        };


        function deletebyname() {
            del_param['name'] = $('#name').val();
            $.ajax({
                url: 'delete.php',
                type: 'post',
                dataType: 'json',
                data: {data: JSON.stringify(del_param)},
                success: function (data) {
                    var html = '<br>name: ' + data['name'] + ' deleted count: ' + data['count'] + '</<br>';
                    $('#result').append(html);
                }
            })
        }
        function clearresult() {
            var resdiv = $('#result').empty();
            resdiv.append('<ol></ol>')
        }
        function getnamelist() {
            $('#hostlist').find('ol').empty();
            var query_name_para = {
                name: '',
                count: ''
            };
            query_name_para.name = $('#namePattern').val();
            query_name_para.count = $('#queryCount').val();
            $.ajax({
                url: 'methodSwitch.php?method=getNameList',
                type: 'post',
                dateType: 'json',
                data: {data: JSON.stringify(query_name_para)},
                success: function (data) {
                    for (var name in data) {
//                        timerange = queryTimeRangeByName(name);
//                        $('#hostlist').find('ol').append('<li>' + name + ' ' + timerange['start']+ ' ' + timerange['stop'] + '</li>');
                        $('#hostlist').find('ol').append('<li>' + name + '</li>');
                    }
                },
                error: function (data) {
                    $('#hostlist').find('ol').append('<br>query name error</br>');
                }
            })
        }

        function queryTimeRangeByName(name) {
            $.ajax({
                url: 'methodSwitch.php?method=queryTimeRange&name=' + name,
                type: 'post',
                data: {data: ''},
                success: function (data) {
                    return data
                },
                error: function (data) {
                    return false;
                }
            })
        }
    </script>
</head>
<body>
<div style="float:left;display:inline-block;">

    <button onclick="clearresult()">clear result</button>
    <br>
    <button onclick="addip()" value="">try_add</button>
    <br>
    <button onclick="querybyname()">try_query_by_name</button>
    <br>
    <button onclick="querybytimeinterval()">try_query_by_time_interval</button>
    <br>
    <button onclick="deletebyname()">try_delete</button>
    <br>
    hostname<input id="name" type="text" value="foo_name"/><br>
    time/rank range start at:<input id="start" type="text" value="0"><br>
    time/rank range stop at:<input id="stop" type="text" value="-1"><br>
    <div id="result">
        <ol>
        </ol>
    </div>
</div>
<div id="hostlist">
    <button onclick="getnamelist()">query name list</button>
    pattern: <input id="namePattern" type="text" value="*">
    count:<input id="queryCount" type="text" value="10">
    <ol></ol>
</div>
</body>
</html>